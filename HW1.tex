% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Homework1},
  pdfauthor={YikunHan42},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi

\title{Homework1}
\author{YikunHan42}
\date{2022-04-04}

\begin{document}
\maketitle

\hypertarget{homework1_part1}{%
\section{homework1\_part1}\label{homework1_part1}}

\hypertarget{importing-libraries}{%
\subsection{Importing libraries}\label{importing-libraries}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: 程辑包'tidyverse'是用R版本4.1.3 来建造的
\end{verbatim}

\begin{verbatim}
## -- Attaching packages --------------------------------------- tidyverse 1.3.1 --
\end{verbatim}

\begin{verbatim}
## v ggplot2 3.3.5     v purrr   0.3.4
## v tibble  3.1.6     v dplyr   1.0.8
## v tidyr   1.2.0     v stringr 1.4.0
## v readr   2.1.2     v forcats 0.5.1
\end{verbatim}

\begin{verbatim}
## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(stringr)}
\end{Highlighting}
\end{Shaded}

\hypertarget{reading-files-setting-variables}{%
\subsection{Reading files \& Setting
variables}\label{reading-files-setting-variables}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"D://Study/DSBI/Task1/test\_id\_card\_no.csv"}\NormalTok{)}
\NormalTok{sex }\OtherTok{=}\FunctionTok{c}\NormalTok{()}
\NormalTok{Birthday }\OtherTok{=}\FunctionTok{c}\NormalTok{()}
\NormalTok{Valid }\OtherTok{=} \FunctionTok{c}\NormalTok{()}
\NormalTok{Age }\OtherTok{=} \FunctionTok{c}\NormalTok{()}
\NormalTok{Zone\_code }\OtherTok{=} \FunctionTok{c}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\hypertarget{section}{%
\subsection{1}\label{section}}

\hypertarget{section-1}{%
\subsubsection{(1)}\label{section-1}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(}\FunctionTok{str\_detect}\NormalTok{(Id\_Card\_No,}\AttributeTok{pattern =} \StringTok{"\^{}22"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   seq         Id_Card_No
## 1   6 222424195110306886
## 2   9 220182196410190862
\end{verbatim}

\hypertarget{section-2}{%
\subsubsection{(2)(3)}\label{section-2}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#flag变量，看是否存在不通过校验码}
\NormalTok{count }\OtherTok{=} \DecValTok{0}
\CommentTok{\#循环处理}
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(data))\{}
\CommentTok{\#校验码}
\NormalTok{  newdata}\OtherTok{\textless{}{-}}\NormalTok{data[}\FunctionTok{c}\NormalTok{(i),}\DecValTok{2}\NormalTok{]}
\NormalTok{  a }\OtherTok{=} \FunctionTok{substring}\NormalTok{(newdata, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{18}\NormalTok{,}\DecValTok{1}\SpecialCharTok{:}\DecValTok{18}\NormalTok{)}

  \ControlFlowTok{if}\NormalTok{( a[}\DecValTok{18}\NormalTok{] }\SpecialCharTok{==} \StringTok{\textquotesingle{}X\textquotesingle{}}\NormalTok{)\{a[}\DecValTok{18}\NormalTok{]}\OtherTok{=}\DecValTok{10}\NormalTok{\}}
\NormalTok{    sum\_ }\OtherTok{=} \DecValTok{0}
    \ControlFlowTok{for}\NormalTok{(j }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\DecValTok{17}\NormalTok{)\{}
\NormalTok{    sum\_ }\OtherTok{=}\NormalTok{ sum\_ }\SpecialCharTok{+}  \FunctionTok{as.numeric}\NormalTok{(a[j]) }\SpecialCharTok{*}\NormalTok{ (}\DecValTok{2}\SpecialCharTok{**}\NormalTok{(}\DecValTok{18}\SpecialCharTok{{-}}\NormalTok{j) }\SpecialCharTok{\%\%} \DecValTok{11}\NormalTok{)}
\NormalTok{    \}}
\NormalTok{    a1 }\OtherTok{=}\NormalTok{ ((sum\_ }\SpecialCharTok{\%\%} \DecValTok{11}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{as.numeric}\NormalTok{(a[}\DecValTok{18}\NormalTok{]))}\SpecialCharTok{\%\%}\DecValTok{11}\SpecialCharTok{{-}} \DecValTok{1}
  \ControlFlowTok{if}\NormalTok{(a[}\DecValTok{18}\NormalTok{]}\SpecialCharTok{==}\StringTok{"10"}\NormalTok{)\{a[}\DecValTok{18}\NormalTok{]}\OtherTok{=}\StringTok{\textquotesingle{}X\textquotesingle{}}\NormalTok{\}}
  
  \ControlFlowTok{if}\NormalTok{(a1 }\SpecialCharTok{!=} \DecValTok{0}\NormalTok{)\{}
\NormalTok{    Valid }\OtherTok{=} \FunctionTok{append}\NormalTok{(Valid,}\DecValTok{0}\NormalTok{)}
\NormalTok{    count }\OtherTok{=}\NormalTok{ count }\SpecialCharTok{+} \DecValTok{1}
  \FunctionTok{print}\NormalTok{(}\StringTok{"效验码不对的："}\NormalTok{)}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(a, }\AttributeTok{sep =} \StringTok{""}\NormalTok{,}\AttributeTok{collapse=}\StringTok{""}\NormalTok{))\}}
  \ControlFlowTok{if}\NormalTok{(a1 }\SpecialCharTok{==} \DecValTok{0}\NormalTok{)\{}
\NormalTok{      Valid }\OtherTok{=} \FunctionTok{append}\NormalTok{(Valid,}\DecValTok{1}\NormalTok{)}
\NormalTok{  \}}
\CommentTok{\#50岁  }
\NormalTok{  byear }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FunctionTok{paste}\NormalTok{(a[}\DecValTok{7}\SpecialCharTok{:}\DecValTok{10}\NormalTok{], }\AttributeTok{sep =} \StringTok{""}\NormalTok{,}\AttributeTok{collapse=}\StringTok{""}\NormalTok{))}
\NormalTok{  bmonth }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FunctionTok{paste}\NormalTok{(a[}\DecValTok{11}\SpecialCharTok{:}\DecValTok{12}\NormalTok{], }\AttributeTok{sep =} \StringTok{""}\NormalTok{,}\AttributeTok{collapse=}\StringTok{""}\NormalTok{))}
\NormalTok{  bday }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FunctionTok{paste}\NormalTok{(a[}\DecValTok{13}\SpecialCharTok{:}\DecValTok{14}\NormalTok{], }\AttributeTok{sep =} \StringTok{""}\NormalTok{,}\AttributeTok{collapse=}\StringTok{""}\NormalTok{))}
\NormalTok{  b }\OtherTok{\textless{}{-}} \FunctionTok{paste}\NormalTok{(byear,bmonth,bday, }\AttributeTok{sep =} \StringTok{"{-}"}\NormalTok{)}
\NormalTok{  today }\OtherTok{\textless{}{-}} \FunctionTok{Sys.Date}\NormalTok{()}
\NormalTok{  gtd }\OtherTok{\textless{}{-}} \FunctionTok{as.Date}\NormalTok{(b) }
\NormalTok{  differencetime }\OtherTok{=} \FunctionTok{difftime}\NormalTok{(today, gtd, }\AttributeTok{units=}\StringTok{"days"}\NormalTok{)}
  \ControlFlowTok{if}\NormalTok{(differencetime}\SpecialCharTok{\textgreater{}}\NormalTok{(}\DecValTok{365}\SpecialCharTok{*}\DecValTok{38}\SpecialCharTok{+}\DecValTok{366}\SpecialCharTok{*}\DecValTok{12}\NormalTok{))\{}
    \FunctionTok{print}\NormalTok{(}\StringTok{"年龄大于50："}\NormalTok{)}
    \FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(a, }\AttributeTok{sep =} \StringTok{""}\NormalTok{,}\AttributeTok{collapse=}\StringTok{""}\NormalTok{))\}}
\CommentTok{\#增添变量}
\NormalTok{  Birthday}\OtherTok{\textless{}{-}}\FunctionTok{append}\NormalTok{(}\AttributeTok{x=}\NormalTok{Birthday,}\FunctionTok{as.Date}\NormalTok{(b))}
\NormalTok{  Age}\OtherTok{\textless{}{-}}\FunctionTok{append}\NormalTok{(Age,}\DecValTok{2022}\SpecialCharTok{{-}}\FunctionTok{as.numeric}\NormalTok{(byear))}
\NormalTok{  Zone\_code }\OtherTok{=} \FunctionTok{append}\NormalTok{(Zone\_code,}\FunctionTok{c}\NormalTok{(}\FunctionTok{paste}\NormalTok{(a[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{2}\NormalTok{], }\AttributeTok{sep =} \StringTok{""}\NormalTok{,}\AttributeTok{collapse=}\StringTok{""}\NormalTok{)))}
  \CommentTok{\#记录性别}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{as.numeric}\NormalTok{(a[}\DecValTok{17}\NormalTok{])}\SpecialCharTok{\%\%}\DecValTok{2}\SpecialCharTok{==}\DecValTok{1}\NormalTok{)\{}
\NormalTok{    sex }\OtherTok{=} \FunctionTok{append}\NormalTok{(sex,}\StringTok{"Male"}\NormalTok{)}
\NormalTok{  \}}
  \ControlFlowTok{else}\NormalTok{\{}
\NormalTok{    sex }\OtherTok{=} \FunctionTok{append}\NormalTok{(sex,}\StringTok{\textquotesingle{}Female\textquotesingle{}}\NormalTok{)}
\NormalTok{  \}}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "年龄大于50："
## [1] "431128197009055759"
## [1] "年龄大于50："
## [1] "360731196804216811"
## [1] "年龄大于50："
## [1] "150123195103126841"
## [1] "年龄大于50："
## [1] "222424195110306886"
## [1] "年龄大于50："
## [1] "61102319591227666X"
## [1] "年龄大于50："
## [1] "141182195505236567"
## [1] "年龄大于50："
## [1] "220182196410190862"
## [1] "年龄大于50："
## [1] "14062219620604034X"
## [1] "年龄大于50："
## [1] "341124196902230765"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{(count }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) }\FunctionTok{print}\NormalTok{(}\StringTok{"全部通过校验"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "全部通过校验"
\end{verbatim}

\hypertarget{section-3}{%
\subsection{2}\label{section-3}}

\hypertarget{section-4}{%
\subsubsection{(1)}\label{section-4}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(Birthday)}
\NormalTok{data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{arrange}\NormalTok{(Birthday) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    seq         Id_Card_No   Birthday
## 1    5 150123195103126841 1951-03-12
## 2    6 222424195110306886 1951-10-30
## 3    8 141182195505236567 1955-05-23
## 4    7 61102319591227666X 1959-12-27
## 5   10 14062219620604034X 1962-06-04
## 6    9 220182196410190862 1964-10-19
## 7    4 360731196804216811 1968-04-21
## 8   11 341124196902230765 1969-02-23
## 9    2 431128197009055759 1970-09-05
## 10   1 431021197306142736 1973-06-14
## 11   3 440700197510019150 1975-10-01
\end{verbatim}

\hypertarget{section-5}{%
\subsubsection{(2)}\label{section-5}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sex }\OtherTok{=} \FunctionTok{as.factor}\NormalTok{(sex)}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(sex)}
\NormalTok{data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{arrange}\NormalTok{(sex,}\FunctionTok{desc}\NormalTok{(Birthday)) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    seq         Id_Card_No   Birthday    sex
## 1   11 341124196902230765 1969-02-23 Female
## 2    9 220182196410190862 1964-10-19 Female
## 3   10 14062219620604034X 1962-06-04 Female
## 4    7 61102319591227666X 1959-12-27 Female
## 5    8 141182195505236567 1955-05-23 Female
## 6    6 222424195110306886 1951-10-30 Female
## 7    5 150123195103126841 1951-03-12 Female
## 8    3 440700197510019150 1975-10-01   Male
## 9    1 431021197306142736 1973-06-14   Male
## 10   2 431128197009055759 1970-09-05   Male
## 11   4 360731196804216811 1968-04-21   Male
\end{verbatim}

\hypertarget{section-6}{%
\subsection{3}\label{section-6}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Valid }\OtherTok{=} \FunctionTok{as.logical}\NormalTok{(Valid)}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(Valid)}
\NormalTok{data}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    seq         Id_Card_No   Birthday    sex Valid
## 1    1 431021197306142736 1973-06-14   Male  TRUE
## 2    2 431128197009055759 1970-09-05   Male  TRUE
## 3    3 440700197510019150 1975-10-01   Male  TRUE
## 4    4 360731196804216811 1968-04-21   Male  TRUE
## 5    5 150123195103126841 1951-03-12 Female  TRUE
## 6    6 222424195110306886 1951-10-30 Female  TRUE
## 7    7 61102319591227666X 1959-12-27 Female  TRUE
## 8    8 141182195505236567 1955-05-23 Female  TRUE
## 9    9 220182196410190862 1964-10-19 Female  TRUE
## 10  10 14062219620604034X 1962-06-04 Female  TRUE
## 11  11 341124196902230765 1969-02-23 Female  TRUE
\end{verbatim}

\hypertarget{section-7}{%
\subsection{4}\label{section-7}}

\hypertarget{section-8}{%
\subsubsection{(1)}\label{section-8}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(Age)}
\NormalTok{data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(}\AttributeTok{Valid=}\ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{summarise}\NormalTok{(}\FunctionTok{mean}\NormalTok{(Age))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   mean(Age)
## 1  58.63636
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(}\AttributeTok{Valid=}\ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{summarise}\NormalTok{(}\FunctionTok{median}\NormalTok{(Age))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   median(Age)
## 1          58
\end{verbatim}

\hypertarget{section-9}{%
\subsubsection{(2)}\label{section-9}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(}\AttributeTok{Valid=}\ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{summarise}\NormalTok{(}\FunctionTok{n}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   n()
## 1  11
\end{verbatim}

\hypertarget{section-10}{%
\subsubsection{(3)}\label{section-10}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(}\AttributeTok{Valid=}\ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{summarise}\NormalTok{(}\FunctionTok{any}\NormalTok{(Age}\SpecialCharTok{\textless{}}\DecValTok{30}\NormalTok{)) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   any(Age < 30)
## 1         FALSE
\end{verbatim}

\hypertarget{section-11}{%
\subsection{5}\label{section-11}}

\hypertarget{section-12}{%
\subsubsection{(1)}\label{section-12}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data  }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(}\AttributeTok{Valid=}\ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{group\_by}\NormalTok{(sex) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{summarise}\NormalTok{(}\FunctionTok{n}\NormalTok{(),}\FunctionTok{mean}\NormalTok{(Age))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 3
##   sex    `n()` `mean(Age)`
##   <fct>  <int>       <dbl>
## 1 Female     7        63.3
## 2 Male       4        50.5
\end{verbatim}

\hypertarget{section-13}{%
\subsubsection{(2)}\label{section-13}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data  }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(}\AttributeTok{Valid=}\ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{group\_by}\NormalTok{(sex) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{summarise}\NormalTok{(}\AttributeTok{n50=}\FunctionTok{sum}\NormalTok{(Age}\SpecialCharTok{\textgreater{}}\DecValTok{50}\NormalTok{),}\AttributeTok{n\_per=}\FunctionTok{mean}\NormalTok{(Age}\SpecialCharTok{\textgreater{}}\DecValTok{50}\NormalTok{)) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 3
##   sex      n50 n_per
##   <fct>  <int> <dbl>
## 1 Female     7   1  
## 2 Male       2   0.5
\end{verbatim}

\hypertarget{section-14}{%
\subsection{6}\label{section-14}}

\hypertarget{section-15}{%
\subsubsection{(1)}\label{section-15}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data  }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(}\AttributeTok{Valid=}\ConstantTok{TRUE}\NormalTok{)  }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(Age}\SpecialCharTok{\textless{}=}\DecValTok{65}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{str\_detect}\NormalTok{(Id\_Card\_No,}\AttributeTok{pattern =} \StringTok{"\^{}220101"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{arrange}\NormalTok{(}\FunctionTok{desc}\NormalTok{(Age))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   seq         Id_Card_No   Birthday    sex Valid Age
## 1   7 61102319591227666X 1959-12-27 Female  TRUE  63
## 2  10 14062219620604034X 1962-06-04 Female  TRUE  60
## 3   9 220182196410190862 1964-10-19 Female  TRUE  58
## 4   4 360731196804216811 1968-04-21   Male  TRUE  54
## 5  11 341124196902230765 1969-02-23 Female  TRUE  53
## 6   2 431128197009055759 1970-09-05   Male  TRUE  52
## 7   1 431021197306142736 1973-06-14   Male  TRUE  49
## 8   3 440700197510019150 1975-10-01   Male  TRUE  47
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{newdata }\OtherTok{\textless{}{-}}\NormalTok{ data[,}\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{)]}
\FunctionTok{write.csv}\NormalTok{(newdata,}\AttributeTok{file =} \StringTok{\textquotesingle{}Out\_Id\_Card\_Data.csv\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{section-16}{%
\subsubsection{(2)}\label{section-16}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{=}\NormalTok{ data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(Zone\_code)}
\NormalTok{data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(}\AttributeTok{Valid=}\ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{group\_by}\NormalTok{(Zone\_code,sex) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{summarise}\NormalTok{(}\AttributeTok{n\_old=}\FunctionTok{sum}\NormalTok{(Age}\SpecialCharTok{\textgreater{}=}\DecValTok{60}\NormalTok{),}\AttributeTok{n\_old\_per=}\FunctionTok{mean}\NormalTok{(Age}\SpecialCharTok{\textgreater{}=}\DecValTok{60}\NormalTok{),}\AttributeTok{n\_not\_old=}\FunctionTok{sum}\NormalTok{(Age}\SpecialCharTok{\textless{}}\DecValTok{60}\NormalTok{),}\AttributeTok{n\_not\_old\_per=}\FunctionTok{mean}\NormalTok{(Age}\SpecialCharTok{\textless{}}\DecValTok{60}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `summarise()` has grouped output by 'Zone_code'. You can override using the
## `.groups` argument.
\end{verbatim}

\begin{verbatim}
## # A tibble: 8 x 6
## # Groups:   Zone_code [8]
##   Zone_code sex    n_old n_old_per n_not_old n_not_old_per
##   <chr>     <fct>  <int>     <dbl>     <int>         <dbl>
## 1 14        Female     2       1           0           0  
## 2 15        Female     1       1           0           0  
## 3 22        Female     1       0.5         1           0.5
## 4 34        Female     0       0           1           1  
## 5 36        Male       0       0           1           1  
## 6 43        Male       0       0           2           1  
## 7 44        Male       0       0           1           1  
## 8 61        Female     1       1           0           0
\end{verbatim}

\hypertarget{homework1_part2}{%
\section{homework1\_part2}\label{homework1_part2}}

\hypertarget{importing-libraries-1}{%
\subsection{Importing libraries}\label{importing-libraries-1}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(Hmisc)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: 程辑包'Hmisc'是用R版本4.1.3 来建造的
\end{verbatim}

\begin{verbatim}
## 载入需要的程辑包：lattice
\end{verbatim}

\begin{verbatim}
## 载入需要的程辑包：survival
\end{verbatim}

\begin{verbatim}
## 载入需要的程辑包：Formula
\end{verbatim}

\begin{verbatim}
## 
## 载入程辑包：'Hmisc'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:dplyr':
## 
##     src, summarize
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:base':
## 
##     format.pval, units
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr)}
\FunctionTok{library}\NormalTok{(plyr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: 程辑包'plyr'是用R版本4.1.3 来建造的
\end{verbatim}

\begin{verbatim}
## ------------------------------------------------------------------------------
\end{verbatim}

\begin{verbatim}
## You have loaded plyr after dplyr - this is likely to cause problems.
## If you need functions from both plyr and dplyr, please load plyr first, then dplyr:
## library(plyr); library(dplyr)
\end{verbatim}

\begin{verbatim}
## ------------------------------------------------------------------------------
\end{verbatim}

\begin{verbatim}
## 
## 载入程辑包：'plyr'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:Hmisc':
## 
##     is.discrete, summarize
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:dplyr':
## 
##     arrange, count, desc, failwith, id, mutate, rename, summarise,
##     summarize
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:purrr':
## 
##     compact
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(stringr)}
\FunctionTok{library}\NormalTok{(lubridate)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## 载入程辑包：'lubridate'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:base':
## 
##     date, intersect, setdiff, union
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyr)}
\end{Highlighting}
\end{Shaded}

\hypertarget{importing-the-file-ux8bfbux5165ux6570ux636e}{%
\subsection{(1) Importing the file
读入数据}\label{importing-the-file-ux8bfbux5165ux6570ux636e}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Sys.setlocale(category="LC\_ALL",locale="en\_US.UTF{-}8")}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{\textquotesingle{}D://Study/DSBI/Task1/pharmacy\_data.csv\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 6574 Columns: 7
## -- Column specification --------------------------------------------------------
## Delimiter: ","
## chr (2): 日期, 品名
## dbl (5): 顾客编号, 品号, 数量, 金额, 折扣金额
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{as\_tibble}\NormalTok{() }\OtherTok{{-}\textgreater{}}\NormalTok{data}
\end{Highlighting}
\end{Shaded}

\hypertarget{summary-view-ux6570ux636eux96c6ux6982ux51b5}{%
\subsection{(2) Summary view
数据集概况}\label{summary-view-ux6570ux636eux96c6ux6982ux51b5}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      日期              顾客编号              品号             品名          
##  Length:6574        Min.   :1.617e+06   Min.   : 236701   Length:6574       
##  Class :character   1st Qu.:1.014e+08   1st Qu.: 861456   Class :character  
##  Mode  :character   Median :1.002e+10   Median : 861507   Mode  :character  
##                     Mean   :6.093e+09   Mean   :1016344                     
##                     3rd Qu.:1.005e+10   3rd Qu.: 869069                     
##                     Max.   :1.284e+10   Max.   :2367012                     
##                     NA's   :2           NA's   :1                           
##       数量              金额            折扣金额      
##  Min.   :-10.000   Min.   :-374.00   Min.   :-374.00  
##  1st Qu.:  1.000   1st Qu.:  14.00   1st Qu.:  12.32  
##  Median :  2.000   Median :  28.00   Median :  26.60  
##  Mean   :  2.386   Mean   :  50.48   Mean   :  46.32  
##  3rd Qu.:  2.000   3rd Qu.:  59.60   3rd Qu.:  53.00  
##  Max.   : 50.000   Max.   :2950.00   Max.   :2650.00  
##  NA's   :1         NA's   :1         NA's   :1
\end{verbatim}

\hypertarget{renaming-date-change-the-data-type-ux91cdux547dux540dux5217ux540dux6539ux6570ux636eux7c7bux578b}{%
\subsection{(3) Renaming date \& change the data type
重命名列名\&改数据类型}\label{renaming-date-change-the-data-type-ux91cdux547dux540dux5217ux540dux6539ux6570ux636eux7c7bux578b}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{rename}\NormalTok{(data,}\FunctionTok{c}\NormalTok{(}\StringTok{"日期"}\OtherTok{=}\StringTok{"销售日"}\NormalTok{))}
\NormalTok{data}\SpecialCharTok{$}\NormalTok{销售日 }\OtherTok{\textless{}{-}} \FunctionTok{ymd}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{销售日)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: 23 failed to parse.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6,574 x 7
##    销售日        顾客编号   品号 品名            数量  金额 折扣金额
##    <date>           <dbl>  <dbl> <chr>          <dbl> <dbl>    <dbl>
##  1 2018-01-15   101554328 236701 三九感冒灵         8 224      208  
##  2 2018-01-20    13389528 236701 三九感冒灵         1  28       28  
##  3 2018-01-31   101464928 236701 三九感冒灵         2  56       56  
##  4 2018-02-17    11177328 236701 三九感冒灵         5 149      131. 
##  5 2018-02-22 10065687828 236701 三九感冒灵         1  29.8     26.2
##  6 2018-02-24    13389528 236701 三九感冒灵         4 119.     105. 
##  7 2018-03-05 10026389628 236701 三九感冒灵         2  59.6     59.6
##  8 2018-03-05   102285028 236701 三九感冒灵         3  84       84  
##  9 2018-03-05 10077400828 236701 清热解毒口服液     1  28       24.6
## 10 2018-03-07 10077400828 236701 清热解毒口服液     5 140      112  
## # ... with 6,564 more rows
\end{verbatim}

\hypertarget{deleting-rows-of-missing-data-ux5220ux9664ux7f3aux5931ux6570ux636eux884c}{%
\subsection{(4) Deleting rows of missing data
删除缺失数据行}\label{deleting-rows-of-missing-data-ux5220ux9664ux7f3aux5931ux6570ux636eux884c}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ data[}\FunctionTok{complete.cases}\NormalTok{(data[,}\DecValTok{1}\SpecialCharTok{:}\DecValTok{2}\NormalTok{]),]}
\end{Highlighting}
\end{Shaded}

\hypertarget{adding-mean-ux63d2ux503cux586bux8865}{%
\subsection{(5) Adding mean
插值填补}\label{adding-mean-ux63d2ux503cux586bux8865}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{group\_by}\NormalTok{(品名)}
\NormalTok{data}\SpecialCharTok{$}\NormalTok{数量[}\FunctionTok{is.na}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{数量)] }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{数量,}\AttributeTok{na.rm=}\ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{excluding-rows-ux6570ux91cfux4e3aux8d1fux7684ux884cux6392ux9664}{%
\subsection{(6) Excluding rows
数量为负的行排除}\label{excluding-rows-ux6570ux91cfux4e3aux8d1fux7684ux884cux6392ux9664}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(数量}\SpecialCharTok{\textgreater{}}\DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{descending-order-ux964dux5e8fux6392ux5217}{%
\subsection{(7) Descending order
降序排列}\label{descending-order-ux964dux5e8fux6392ux5217}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{arrange}\NormalTok{(}\FunctionTok{desc}\NormalTok{(销售日))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6,505 x 7
## # Groups:   品名 [78]
##    销售日        顾客编号    品号 品名                      数量  金额 折扣金额
##    <date>           <dbl>   <dbl> <chr>                    <dbl> <dbl>    <dbl>
##  1 2018-07-19     1616528  236701 清热解毒口服液               1  28       28  
##  2 2018-07-19 10013306428 2367011 开博通                       1  31       28  
##  3 2018-07-19 10030713328 2367011 开博通                       4 124      118  
##  4 2018-07-19 10059383628 2367011 开博通                       2  62       56  
##  5 2018-07-19   101409528 2367011 开博通                       2  62       56  
##  6 2018-07-19    13406628 2367011 开博通                       2  62       56  
##  7 2018-07-19 10065621228  861435 缬沙坦胶囊(代文)             2  71.6     64  
##  8 2018-07-19 10081634128  861459 吲达帕胺片(寿比山)           2  33       29.6
##  9 2018-07-19   101921828  861464 复方利血平片(复方降压片)     1   3.7      3.3
## 10 2018-07-19    13216828  861464 复方利血平片(复方降压片)     1   3.7      3.3
## # ... with 6,495 more rows
\end{verbatim}

\hypertarget{adding-line-ux589eux52a0ux65b0ux5217}{%
\subsection{(8) Adding line
增加新列}\label{adding-line-ux589eux52a0ux65b0ux5217}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(折扣率}\OtherTok{=}\NormalTok{ (金额}\SpecialCharTok{{-}}\NormalTok{折扣金额)}\SpecialCharTok{/}\NormalTok{金额)}
\NormalTok{data}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6,505 x 8
## # Groups:   品名 [78]
##    销售日        顾客编号   品号 品名            数量  金额 折扣金额 折扣率
##    <date>           <dbl>  <dbl> <chr>          <dbl> <dbl>    <dbl>  <dbl>
##  1 2018-01-15   101554328 236701 三九感冒灵         8 224      208   0.0714
##  2 2018-01-20    13389528 236701 三九感冒灵         1  28       28   0     
##  3 2018-01-31   101464928 236701 三九感冒灵         2  56       56   0     
##  4 2018-02-17    11177328 236701 三九感冒灵         5 149      131.  0.12  
##  5 2018-02-22 10065687828 236701 三九感冒灵         1  29.8     26.2 0.120 
##  6 2018-02-24    13389528 236701 三九感冒灵         4 119.     105.  0.120 
##  7 2018-03-05 10026389628 236701 三九感冒灵         2  59.6     59.6 0     
##  8 2018-03-05   102285028 236701 三九感冒灵         3  84       84   0     
##  9 2018-03-05 10077400828 236701 清热解毒口服液     1  28       24.6 0.12  
## 10 2018-03-07 10077400828 236701 清热解毒口服液     5 140      112   0.2   
## # ... with 6,495 more rows
\end{verbatim}

\hypertarget{statistic-about-sale-ux7edfux8ba1ux603bux5b9eux9645ux9500ux552eux989dux603bux9500ux552eux5355ux6570}{%
\subsection{(9) Statistic about sale
统计总实际销售额、总销售单数}\label{statistic-about-sale-ux7edfux8ba1ux603bux5b9eux9645ux9500ux552eux989dux603bux9500ux552eux5355ux6570}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{summarise}\NormalTok{(}\AttributeTok{n\_sale=}\FunctionTok{sum}\NormalTok{(折扣金额), }\AttributeTok{n\_num=}\FunctionTok{sum}\NormalTok{(数量))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##     n_sale n_num
## 1 303898.3 15646
\end{verbatim}

\hypertarget{statistic-by-commodity-ux7edfux8ba1ux5404ux79cdux5546ux54c1ux7684ux6307ux6807}{%
\subsection{(10) Statistic by commodity
统计各种商品的指标}\label{statistic-by-commodity-ux7edfux8ba1ux5404ux79cdux5546ux54c1ux7684ux6307ux6807}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{group\_by}\NormalTok{(品名) }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{summarise}\NormalTok{(}\AttributeTok{n\_num=}\FunctionTok{n}\NormalTok{(),}\AttributeTok{n\_sale=}\FunctionTok{sum}\NormalTok{(金额),}\AttributeTok{n\_average=}\FunctionTok{sum}\NormalTok{(金额)}\SpecialCharTok{/}\FunctionTok{sum}\NormalTok{(数量))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 78 x 4
##    品名                            n_num n_sale n_average
##    <chr>                           <int>  <dbl>     <dbl>
##  1 **阿替洛尔片                        8   76.5       4.5
##  2 **盐酸阿罗洛尔片(阿尔马尔)         34 4040        40  
##  3 D苯磺酸氨氯地平胶囊(丽珠优可)       1  453        15.1
##  4 D厄贝沙坦氢氯噻嗪片(倍悦)           1  132.       66.1
##  5 D替格瑞洛片                         1 2500       250  
##  6 D盐酸贝尼地平片                     3 1125.       34.1
##  7 G苯磺酸氨氯地平片(6盒/疗程)        72 2968.       12.5
##  8 G厄贝沙坦分散片(6盒/疗程)           9  576        32  
##  9 G琥珀酸美托洛尔缓释片(倍他乐克)   195 9648.       19.0
## 10 G硝苯地平缓释片(II)(6盒/疗程)       9  480        30  
## # ... with 68 more rows
\end{verbatim}

\hypertarget{statistic-by-month-ux6309ux6708ux7edfux8ba1}{%
\subsection{(11) Statistic by month
按月统计}\label{statistic-by-month-ux6309ux6708ux7edfux8ba1}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(年}\OtherTok{=}\FunctionTok{year}\NormalTok{(销售日)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(月}\OtherTok{=}\FunctionTok{month}\NormalTok{(销售日)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(年\_月}\OtherTok{=}\FunctionTok{str\_c}\NormalTok{(年,月,}\AttributeTok{sep =} \StringTok{"{-}"}\NormalTok{)) }\OtherTok{{-}\textgreater{}}\NormalTok{ data}
\NormalTok{data }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(年\_月) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{summarise}\NormalTok{(}
\NormalTok{    销售单数 }\OtherTok{=} \FunctionTok{sum}\NormalTok{(数量),}
\NormalTok{    总销售额 }\OtherTok{=} \FunctionTok{sum}\NormalTok{(金额),}
\NormalTok{    平均价格 }\OtherTok{=} \FunctionTok{mean}\NormalTok{(金额)) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 7 x 4
##   年_月  销售单数 总销售额 平均价格
##   <chr>     <dbl>    <dbl>    <dbl>
## 1 2018-1     2517   53406      50.8
## 2 2018-2     1858   42029.     56.6
## 3 2018-3     2225   45318      45.8
## 4 2018-4     3010   54324.     44.0
## 5 2018-5     2225   51263.     53.8
## 6 2018-6     2328   52301.     57.5
## 7 2018-7     1483   32568      51.9
\end{verbatim}

\hypertarget{statistic-by-customer-ux7edfux8ba1ux6bcfux4f4dux987eux5ba2ux6bcfux6708ux7684ux5b9eux9645ux6d88ux8d39ux91d1ux989d}{%
\subsection{(12) Statistic by customer
统计每位顾客每月的实际消费金额}\label{statistic-by-customer-ux7edfux8ba1ux6bcfux4f4dux987eux5ba2ux6bcfux6708ux7684ux5b9eux9645ux6d88ux8d39ux91d1ux989d}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(顾客\_月}\OtherTok{=}\FunctionTok{str\_c}\NormalTok{(顾客编号,年\_月,}\AttributeTok{sep =} \StringTok{"{-}"}\NormalTok{))}\OtherTok{{-}\textgreater{}}\NormalTok{ data}
\NormalTok{data }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(顾客\_月) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{summarise}\NormalTok{(}
\NormalTok{    总消费额}\OtherTok{=}\FunctionTok{sum}\NormalTok{(折扣金额))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4,375 x 2
##    顾客_月         总消费额
##    <chr>              <dbl>
##  1 10000428-2018-2     17  
##  2 10000528-2018-5     25  
##  3 10001928-2018-1      2.2
##  4 10005028-2018-1    276. 
##  5 10005028-2018-2     50  
##  6 10005028-2018-4     23.6
##  7 10005028-2018-7     47.2
##  8 10006928-2018-3     12.3
##  9 10006928-2018-4      5.4
## 10 10006928-2018-6      6.4
## # ... with 4,365 more rows
\end{verbatim}

\end{document}
